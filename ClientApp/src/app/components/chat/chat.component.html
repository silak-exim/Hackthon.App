<div class="chat-container">
  <div class="chat-header">
    <h2>AI Assistant</h2>
    <div class="header-actions">
      <button class="context-toggle" (click)="toggleContext()">
        {{ showContextInput() ? '‡∏ã‡πà‡∏≠‡∏ô Context' : '‡πÄ‡∏û‡∏¥‡πà‡∏° Context' }}
      </button>
      <button class="clear-btn" (click)="clearChat()" [disabled]="!hasMessages()">
        ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
      </button>
    </div>
  </div>

  @if (showContextInput()) {
    <div class="context-section">
      <label>Context (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•)</label>
      <textarea 
        [ngModel]="context()" 
        (ngModelChange)="updateContext($event)"
        placeholder="‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö..."
        rows="3">
      </textarea>
    </div>
  }

  <div class="messages-container">
    @if (!hasMessages()) {
      <div class="empty-state">
        <span class="icon">üí¨</span>
        <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà EXIM Bank AI</p>
        <small>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</small>
      </div>
    }

    @for (msg of messages(); track trackByTimestamp($index, msg)) {
      <div class="message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
        <div class="avatar">
          {{ msg.role === 'user' ? 'üë§' : 'üè¶' }}
        </div>
        <div class="content">
          <div class="text" [innerHTML]="msg.content"></div>
          <div class="time">{{ msg.timestamp | date:'HH:mm' }}</div>
        </div>
      </div>
    }

    @if (isLoading()) {
      <div class="message assistant">
        <div class="avatar">üè¶</div>
        <div class="content">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="input-container">
    <textarea 
      [ngModel]="userInput()" 
      (ngModelChange)="updateUserInput($event)"
      (keypress)="onKeyPress($event)"
      placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
      rows="1"
      [disabled]="isLoading()">
    </textarea>
    <button class="send-btn" (click)="sendMessage()" [disabled]="!canSend()">
      ‚û§
    </button>
  </div>
</div>
