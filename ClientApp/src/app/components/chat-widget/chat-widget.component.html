<!-- Floating Chat Button -->
<button class="chat-toggle" (click)="toggleChat()" [class.open]="isOpen()">
  @if (isOpen()) {
    <span class="icon close">тЬХ</span>
  } @else {
    <span class="icon chat">ЁЯТм</span>
    @if (unreadCount() > 0) {
      <span class="badge">{{ unreadCount() }}</span>
    }
  }
</button>

<!-- Chat Window -->
<div class="chat-window" [class.open]="isOpen()">
  <div class="chat-header">
    <div class="header-info">
      <div class="avatar">ЁЯПж</div>
      <div class="header-text">
        <h3>EXIM Bank AI</h3>
        <span class="status">
          <span class="status-dot"></span>
          р╕нр╕нр╕Щр╣Др╕ер╕Щр╣М
        </span>
      </div>
    </div>
    <div class="header-actions">
      <button class="action-btn" (click)="clearChat()" title="р╕ер╣Йр╕▓р╕Зр╕Бр╕▓р╕гр╕кр╕Щр╕Чр╕Щр╕▓">ЁЯЧСя╕П</button>
      <button class="action-btn" (click)="toggleChat()" title="р╕Ыр╕┤р╕Ф">тЬХ</button>
    </div>
  </div>

  <div class="messages-container">
    @if (!hasMessages()) {
      <div class="welcome-message">
        <div class="welcome-icon">ЁЯПж</div>
        <h4>р╕кр╕зр╕▒р╕кр╕Фр╕╡р╕Др╣Ир╕░!</h4>
        <p>р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╕кр╕╣р╣И EXIM Bank AI Assistant</p>
        <p class="sub">р╕кр╕нр╕Ър╕Цр╕▓р╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Шр╕Щр╕▓р╕Др╕▓р╕г р╕лр╕гр╕╖р╕нр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╕Кр╣Ир╕зр╕вр╣Ар╕лр╕ер╕╖р╕н р╕Юр╕┤р╕бр╕Юр╣Мр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╣Ир╕░</p>
        <div class="quick-actions">
          <button (click)="sendQuickMessage('р╕нр╕▒р╕Хр╕гр╕▓р╣Бр╕ер╕Бр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕зр╕▒р╕Щр╕Щр╕╡р╣Й')">ЁЯТ▒ р╕нр╕▒р╕Хр╕гр╕▓р╣Бр╕ер╕Бр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ</button>
          <button (click)="sendQuickMessage('р╕кр╕┤р╕Щр╣Ар╕Кр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕нр╕нр╕Б')">ЁЯУж р╕кр╕┤р╕Щр╣Ар╕Кр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕нр╕нр╕Б</button>
          <button (click)="sendQuickMessage('р╕Ър╕гр╕┤р╕Бр╕▓р╕г L/C')">ЁЯУД Letter of Credit</button>
        </div>
      </div>
    }

    @for (msg of messages(); track trackByTimestamp($index, msg)) {
      <div class="message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
        @if (msg.role === 'assistant') {
          <div class="msg-avatar">ЁЯПж</div>
        }
        <div class="msg-content">
          <div class="msg-text" [innerHTML]="msg.content"></div>
          <div class="msg-time">{{ msg.timestamp | date:'HH:mm' }}</div>
        </div>
      </div>
    }

    @if (isLoading()) {
      <div class="message assistant">
        <div class="msg-avatar">ЁЯПж</div>
        <div class="msg-content">
          <div class="typing">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="input-area">
    <input 
      type="text"
      [ngModel]="userInput()" 
      (ngModelChange)="updateUserInput($event)"
      (keypress)="onKeyPress($event)"
      placeholder="р╕Юр╕┤р╕бр╕Юр╣Мр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б..."
      [disabled]="isLoading()">
    <button class="send-btn" (click)="sendMessage()" [disabled]="!canSend()">
      <span>тЮд</span>
    </button>
  </div>
</div>
