<div class="search-container">
  <div class="tabs">
    <button 
      [class.active]="activeTab() === 'search'" 
      (click)="switchTab('search')">
      ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
    </button>
    <button 
      [class.active]="activeTab() === 'documents'" 
      (click)="switchTab('documents')">
      ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </button>
  </div>

  @if (activeTab() === 'search') {
    <div class="search-section">
      <div class="search-box-wrapper">
        <div class="search-box">
          <input 
            type="text" 
            [ngModel]="searchQuery()" 
            (ngModelChange)="onSearchInput($event)"
            (keypress)="onKeyPress($event)"
            (focus)="showSuggestions.set(true)"
            (blur)="hideSuggestionsDelayed()"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£..."
            [disabled]="isSearching()">
          <button (click)="search()" [disabled]="!canSearch()">
            @if (isSearching()) {
              <span class="spinner"></span>
            } @else {
              üîç
            }
          </button>
        </div>

        <!-- Autocomplete Suggestions -->
        @if (showSuggestions() && filteredSuggestions().length > 0) {
          <div class="suggestions-dropdown">
            @for (suggestion of filteredSuggestions(); track suggestion.id) {
              <div class="suggestion-item" (mousedown)="selectSuggestion(suggestion)">
                <span class="suggestion-icon">üìÑ</span>
                <div class="suggestion-content">
                  <span class="suggestion-title">{{ suggestion.title }}</span>
                  <span class="suggestion-filename">{{ suggestion.fileName }}</span>
                </div>
              </div>
            }
          </div>
        }
      </div>

      @if (errorMessage()) {
        <div class="error-message">
          {{ errorMessage() }}
        </div>
      }

      @if (hasSearchResults()) {
        <div class="results">
          <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ({{ searchResultsCount() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
          @for (result of searchResults(); track trackByResultId($index, result)) {
            <div class="result-item">
              <div class="result-header">
                <span class="title">{{ result.title }}</span>
                <span class="score">Score: {{ result.score.toFixed(2) }}</span>
              </div>
              <p class="snippet">{{ result.snippet }}</p>
            </div>
          }
        </div>
      } @else if (!isSearching() && searchQuery() && !errorMessage()) {
        <div class="no-results">
          <span class="icon">üì≠</span>
          <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "{{ searchQuery() }}"</p>
        </div>
      }
    </div>
  }

  @if (activeTab() === 'documents') {
    <div class="documents-section">
      @if (isLoadingDocs()) {
        <div class="loading">
          <span class="spinner large"></span>
          <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£...</p>
        </div>
      } @else if (hasDocuments()) {
        <div class="documents-list">
          <h3>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ documentsCount() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
          <table>
            <thead>
              <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå</th>
                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody>
              @for (doc of allDocuments(); track trackByDocId($index, doc)) {
                <tr>
                  <td>{{ doc.title }}</td>
                  <td>{{ doc.fileName }}</td>
                  <td>
                    <button class="delete-btn" (click)="deleteDocument(doc.id)">‡∏•‡∏ö</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <div class="empty-state">
          <span class="icon">üìÑ</span>
          <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
          <small>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</small>
        </div>
      }
    </div>
  }
</div>
